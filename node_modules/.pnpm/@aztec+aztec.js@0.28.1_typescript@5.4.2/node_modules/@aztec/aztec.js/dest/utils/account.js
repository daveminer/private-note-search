import { retryUntil } from '@aztec/foundation/retry';
import { DefaultWaitOpts } from '../contract/index.js';
/**
 * Waits for the account to finish synchronizing with the PXE Service.
 * @param pxe - PXE instance
 * @param address - Address to wait for synch
 * @param opts - Wait options
 */
export async function waitForAccountSynch(pxe, address, { interval, timeout } = DefaultWaitOpts) {
    const publicKey = address.publicKey.toString();
    await retryUntil(async () => {
        const status = await pxe.getSyncStatus();
        const accountSynchedToBlock = status.notes[publicKey];
        if (typeof accountSynchedToBlock === 'undefined') {
            return false;
        }
        else {
            return accountSynchedToBlock >= status.blocks;
        }
    }, 'waitForAccountSynch', timeout, interval);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3VudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9hY2NvdW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUVyRCxPQUFPLEVBQUUsZUFBZSxFQUFZLE1BQU0sc0JBQXNCLENBQUM7QUFFakU7Ozs7O0dBS0c7QUFDSCxNQUFNLENBQUMsS0FBSyxVQUFVLG1CQUFtQixDQUN2QyxHQUFRLEVBQ1IsT0FBd0IsRUFDeEIsRUFBRSxRQUFRLEVBQUUsT0FBTyxLQUFlLGVBQWU7SUFFakQsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUMvQyxNQUFNLFVBQVUsQ0FDZCxLQUFLLElBQUksRUFBRTtRQUNULE1BQU0sTUFBTSxHQUFHLE1BQU0sR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3pDLE1BQU0scUJBQXFCLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN0RCxJQUFJLE9BQU8scUJBQXFCLEtBQUssV0FBVyxFQUFFLENBQUM7WUFDakQsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO2FBQU0sQ0FBQztZQUNOLE9BQU8scUJBQXFCLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNoRCxDQUFDO0lBQ0gsQ0FBQyxFQUNELHFCQUFxQixFQUNyQixPQUFPLEVBQ1AsUUFBUSxDQUNULENBQUM7QUFDSixDQUFDIn0=